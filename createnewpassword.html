<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create New Password</title>
    <link rel="icon" type="image/x-icon" href="images/favicon.ico" />
    <!-- Bootstrap & CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./styles/main.css" />
    <link rel="stylesheet" href="./styles/styles.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script
      async
      defer
      crossorigin="anonymous"
      src="https://connect.facebook.net/en_US/sdk.js"
    ></script>
  </head>
  <body>
    <div id="wrapper">
      <header>
        <!-- Header -->
        <div id="subHeader" class="d-none d-lg-flex justify-content-end">
          <img src="images/Calling.svg" alt="Phone Icon" />
          <a href="tel:+44 1225 985355">+44 1225 985355</a>
          <span class="div"></span>
          <img src="images/Envelope.svg" alt="Envelope Icon" />
          <a href="mailto:info@yachtngo.com">Contact us</a>
        </div>
        <hr class="d-none d-lg-block" />
        <nav id="navWrapper">
          <!-- Desktop -->
          <div class="row align-items-center d-none d-lg-flex">
            <div class="col-lg-9 col-md-6">
              <img src="./images/Logo.svg" alt="YachtFleetCharter Logo" />
            </div>
            <div class="col-lg-3 col-md-6" id="navLinks">
              <a href="login.html" class="login-register" id="loginLinkDesktop"
                >Login</a
              >
              <a href="login.html" class="logout" id="logoutLinkDesktop"
                >Log Out</a
              >
              <span class="div"></span>
              <a href="register.html" id="registerLinkDesktop">Register</a>
              <img
                src="images/Profile.svg"
                alt="avatar-icon"
                id="desktopProfileIcon"
              />
            </div>
          </div>
          <!-- Mobile -->
          <div id="mobileHeader" class="d-lg-none d-sm-block">
            <div class="d-flex justify-content-between">
              <img
                src="images/YNG_logo.svg"
                alt="YachtNGo Logo"
                class="img-responsive"
              />
              <img
                src="images/logotext.svg"
                alt="YachtNGo text logo"
                class="img-responsive logoText"
              />
              <div class="profile-container">
                <img
                  src="images/Profile.svg"
                  alt="Profile"
                  class="img-responsive mt-2"
                  id="mobileProfileIcon"
                />
                <div id="mobileProfileDropdown" class="dropdown-menu">
                  <a
                    href="login.html"
                    class="dropdown-item login-register"
                    id="loginLinkMobile"
                    >Login</a
                  >
                  <a
                    href="register.html"
                    class="dropdown-item"
                    id="registerLinkMobile"
                    >Register</a
                  >
                  <a
                    href="login.html"
                    class="dropdown-item logout"
                    id="logoutLinkMobile"
                    >Logout</a
                  >
                </div>
              </div>
            </div>
          </div>
        </nav>
      </header>
      <div id="mainWrapper">
        <section id="formWrapper" class="container">
          <h3>Create new password</h3>
          <div id="formWidget">
            <form id="createPasswordForm" novalidate>
              <p class="text-center mb-2 info">
                Your new password must be different<br />
                from the previously used password
              </p>
              <div class="mt-3 mb-3">
                <label
                  for="passwordInput"
                  class="form-label"
                  autocomplete="new-password"
                  >New Password</label
                >
                <div class="password-wrapper">
                  <input
                    type="password"
                    class="form-control"
                    id="passwordInput"
                    required
                  />
                  <img
                    src="images/eyeicon.svg"
                    alt="Toggle Password Visibility"
                    class="eye-icon"
                    id="togglePassword"
                    autocomplete="new-password"
                  />
                </div>
              </div>
              <div class="mt-3">
                <label for="passwordConfirm" class="form-label"
                  >Confirm New Password</label
                >
                <div class="password-wrapper">
                  <input
                    type="password"
                    class="form-control"
                    id="passwordConfirm"
                    required
                  />
                  <img
                    src="images/eyeicon.svg"
                    alt="Toggle Password Visibility"
                    class="eye-icon"
                    id="togglePasswordConfirm"
                  />
                </div>
              </div>
              <button type="submit" class="primaryBtn">Create</button>
            </form>
            <div id="successMessage" style="display: none"></div>
          </div>
        </section>
      </div>
    </div>

    <!-- Bootstrap JavaScript Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
      integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
      crossorigin="anonymous"
    ></script>

    <!-- Facebook SDK -->
    <script
      async
      defer
      crossorigin="anonymous"
      src="https://connect.facebook.net/en_US/sdk.js"
    ></script>
    <script>
      window.fbAsyncInit = function () {
        FB.init({
          appId: "YOUR_APP_ID",
          cookie: true,
          xfbml: true,
          version: "v12.0",
        });
      };
    </script>

    <!-- Custom Scripts -->
    <script>
      // Read and decode the token from the URL (manual parsing)
      const query = window.location.search.substring(1); // remove '?'
      const vars = query.split("&");
      let token = null;
      for (let i = 0; i < vars.length; i++) {
        const pair = vars[i].split("=");
        if (decodeURIComponent(pair[0]) === "token") {
          token = decodeURIComponent(pair[1]);
          break;
        }
      }
      let resetEmail = null;
      if (token) {
        try {
          const decoded = atob(token);
          resetEmail = decoded.split(":")[0];
          // Optionally display the email or store for use in form submission
        } catch (e) {
          resetEmail = null;
        }
      }
      // You can use resetEmail in your password reset logic
    </script>
    <script src="config.js"></script>
    <script src="./scripts/authService.js"></script>
    <script src="./scripts/formValidationService.js"></script>
    <script src="./scripts/uiService.js"></script>
    <script src="./scripts/main.js"></script>
  </body>
</html>
